{% extends "base.html" %}
{% load i18n %}

{% block container %}
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <table class="table table-striped table-hover" id="search-members-results">
          <thead>
            <tr>
              <th>{% trans "Nom" %}</th>
              <th>{% trans "Prénom" %}</th>
              <th>{% trans "Email" %}</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
$(function()
{
  get_members_results();
});

// Fonction qui remplira le <table> avec les résultats de la recherche des members
function fill_table_results(data, table_element)
{
  // Vide le contenu de la table avant de la remplir
  $(table_element.selector + " > tbody").empty();

  $.each(data.results,
    function(index, value) {
      var $tr = $('<tr>').append($('<td>').text(value.lastname),
                               $('<td>').text(value.firstname),
                               $('<td>').text(value.email));

      $tr.appendTo(table_element);
    }
  );
}

// Fonction qui requete l'API pour récupérer les résultats de la recherche des members
function get_members_results()
{
  $.ajax({
    type: "get",
    // URL que l'on va requeter
    url: "{{ django_settings.API_URL }}members/",
    // Données à passer pour faire une recherche
    data: {format: "json"},
    // Fonction exécutée en cas de réussite de la requete,
    // la var data étant ce que l'on a récupéré comme résultat
    success: function(data)
    {
      // Affichage du tableau des résultats
      fill_table_results(data, $("#search-members-results"));
    },
    error: function(data)
    {
      //
    },
  });
}
</script>
{% endblock %}